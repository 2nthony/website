import Callout from "nextra-theme-docs/callout";

# WebAssembly Plugins

<Callout emoji="ðŸš§">

The WASM plugins interface is still experimental. Please share your [bug reports and feedback](https://github.com/swc-project/swc/discussions/3540).

</Callout>

Use the WebAssembly interace to extend SWC and create high-performance [plugins](https://github.com/swc-project/plugins).

## Create your first plugin

You can create your first WebAssembly plugin for SWC using the CLI.

First, install the [CLI package](https://crates.io/crates/swc_plugin) through cargo:

```bash
$ cargo install swc_cli
```

We've provided helpful code generation to scaffold a new project for creating plugins. Create a new plugin project using the SWC CLI:

```bash
$ swc plugin new my-plugin --target-type=wasm32-wasi
```

## Example plugin

Here's an example plugin that replaces `console.log(${text})` with `console.log('changed_via_plugin')`:

```rust
use swc_plugin::{ast::*, errors::HANDLER, plugin_transform, syntax_pos::DUMMY_SP};

struct ConsoleOutputReplacer;

/// An example plugin replaces any `console.log(${text})` into
/// `console.log('changed_via_plugin')`.
impl VisitMut for ConsoleOutputReplacer {
    fn visit_mut_call_expr(&mut self, call: &mut CallExpr) {
        if let Callee::Expr(expr) = &call.callee {
            if let Expr::Member(MemberExpr { obj, .. }) = &**expr {
                if let Expr::Ident(ident) = &**obj {
                    if ident.sym == *"console" {
                        call.args[0].expr = Box::new(Expr::Lit(Lit::Str(Str {
                            span: DUMMY_SP,
                            has_escape: false,
                            kind: StrKind::default(),
                            value: JsWord::from("changed_via_plugin"),
                        })));
                    }
                }
            }
        }
    }
}
```

## Publishing

To publish your WebAssembly plugin to npm, you can build the required `.wasm` file using `cargo build`:

```sh
$ cargo build --release --target wasm32-wasi
```

## Adjusting configuration for smaller plugins

You can reduce the size of your plugin by configuring your `Cargo.toml` file:

```toml
[profile.release]
# Remove more dead code
codegen-units = 1
lto = true
# Optimize for size
opt-level = "s"
```

## Plugins CLI Reference

- `--target`
  - `wasm32-wasi`
  - `wasm32-unknown-unknown`
