---
image: https://user-images.githubusercontent.com/9113740/140682117-5e9f460e-c8f1-447c-88a0-e75f80779260.png
description: 'SWC (Speedy Web Compiler) is a super-fast JavaScript and TypeScript compiler.'
---

import Authors, { Author } from 'components/authors'

# Announcing WebAssembly Plugins for SWC

<Authors date="February 13th, 2022">
  <Author name="DongYoon Kang" link="https://twitter.com/kdy1dev" />
  <Author name="Lee Robinson" link="https://twitter.com/leeerob" />
</Authors>

SWC is an extensible Rust-based platform for the next generation of fast and extensible developer tools. To enable developers to further extend the platform, we're announcing a **new WebAssembly plugin interface** to write high-performance plugins.

## Why WebAssembly?

SWC currently has a [JavaScript plugin interface](https://swc.rs/docs/usage/plugins), but it has a few tradeoffs. These JavaScript plugins are more difficult to integrate with Rust code, and can often lead to performance bottlenecks.

When designing our new plugin interface, we oulined a few goals:

1. Plugin binaries should be able to be loaded into SWC's native binary _without_ using the JavaScript binding interop.
2. Provide excellent performance while loading and running custom transformations.
3. Ensure API stability to allow plugin binary to work across different versions of SWC.
4. Allow developers to write plugins without needing to worry about native platform target binaries.

## Options Evaluated

With these goals defined, we evaluated four different options:

- JavaScript-based plugins, including Babel plugins
- Plugins based on `abi_stable` and native dynamic libraries
- WASM plugins based on `wasmtime`
- WASM plugins based on `wasmer`

After evaluating options, we choose to use WASM plugins based on wasmer. You can view the [full pros / cons list here](https://github.com/swc-project/swc/blob/8652b2df99c37527fcd973bd8f0cd3c54bfa9485/docs/adr/00001-support-transformation-plugin-native.md).

## Benchmarks

### Performance vs. JavaScript Plugins

TODO

### Performance vs. Initial Protoype

TODO

## Create your first WASM plugin

You can create your first WebAssembly plugin for SWC using the CLI.

First, install the [CLI package](https://crates.io/crates/swc_plugin) through cargo:

```bash
$ cargo install swc_cli
```

We've provided helpful code generation to scaffold a new project for creating plugins. Create a new plugin project using the SWC CLI:

```bash
$ swc plugin new my-plugin --target-type=wasm32-wasi
```

Here's an example plugin that replaces `console.log(${text})` with `console.log('changed_via_plugin')`:

```rust
use swc_plugin::{ast::*, errors::HANDLER, plugin_transform, syntax_pos::DUMMY_SP};

struct ConsoleOutputReplacer;

/// An example plugin replaces any `console.log(${text})` into
/// `console.log('changed_via_plugin')`.
impl VisitMut for ConsoleOutputReplacer {
    fn visit_mut_call_expr(&mut self, call: &mut CallExpr) {
        if let Callee::Expr(expr) = &call.callee {
            if let Expr::Member(MemberExpr { obj, .. }) = &**expr {
                if let Expr::Ident(ident) = &**obj {
                    if ident.sym == *"console" {
                        call.args[0].expr = Box::new(Expr::Lit(Lit::Str(Str {
                            span: DUMMY_SP,
                            has_escape: false,
                            kind: StrKind::default(),
                            value: JsWord::from("changed_via_plugin"),
                        })));
                    }
                }
            }
        }
    }
}
```

## Learn more

WASM Plugins are currently experimental, as we expect we'll have to iterate on the API and address bug fixes. If you have suggestions or bug reports, please [comment on the discussion](https://github.com/swc-project/swc/discussions/3540).

[Check out the documentation](/docs/plugins/wasm) for more information.
